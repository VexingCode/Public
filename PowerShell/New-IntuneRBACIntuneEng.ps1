# Install and import the relevant module
Function Install-RequiredModule {
    [CmdletBinding()]
    param (
        [Parameter()]
        [string]
        $Name
    )

    Write-Verbose "Grabbing the version of $Name from the gallery."
    $GalleryModuleVersion = (Find-Module $Name).Version
    Write-Verbose 'Gallery version is:'
    Write-Verbose $GalleryModuleVersion
    Write-Verbose "Grabbing the version of $Name that is installed (if any)."
    $InstalledModuleVersion = (Get-InstalledModule $Name -ErrorAction SilentlyContinue).Version
    If ($null -eq $InstalledModuleVersion) {
        $InstalledModuleVersion = 'Not installed.'
    }
    Write-Verbose 'Installed version is:'
    Write-Verbose $InstalledModuleVersion
    Write-Verbose 'Comparing the two to see if the gallery is newer.'
    If (!($InstalledModuleVersion -ge $GalleryModuleVersion)) {
        Write-Verbose 'Gallery version is newer, or its not installed.'
        Write-Verbose "Installing the $Name module."
        Install-Module $Name -Force -AllowClobber
        Write-Verbose "Importing the $Name module."
        Import-Module $Name
    }
    Else {
        Write-Verbose "$Name module is current."
    }
}
Install-RequiredModule Microsoft.Graph.DeviceManagement.Administration -Verbose

# Select beta Graph profile
Select-MgProfile -Name Beta

# Connect to Microsoft Graph, with the specified scope
# Keep in mind, the account running this must have the appropriate permissions
Connect-MgGraph -Scopes DeviceManagementRBAC.ReadWrite.All

# Set the URI path
$uri = "https://graph.microsoft.com/beta/deviceManagement/roleDefinitions/"

# Create the json payload
$json = @'
	{
    "@odata.context": "https://graph.microsoft.com/beta/$metadata#deviceManagement/roleDefinitions/$entity",
    "@odata.type": "#microsoft.graph.deviceAndAppManagementRoleDefinition",
    "displayName": "Intune Engineer",
    "description": "Grants permissions similar to an Intune Administrators, without full control. Intended for the team members that are not Intune Administrators.",
    "isBuiltInRoleDefinition": false,
    "isBuiltIn": false,
    "roleScopeTagIds": [],
    "permissions": [
                {
                    "actions": [
                        "Microsoft.Intune_AndroidSync_Read",
                        "Microsoft.Intune_MobileApps_Read",
                        "Microsoft.Intune_ManagedApps_Read",
                        "Microsoft.Intune_PolicySets_Read",
                        "Microsoft.Intune_ManagedApps_Wipe",
                        "Microsoft.Intune_Reports_Read",
                        "Microsoft.Intune_Customization_Read",
                        "Microsoft.Intune_MobileApps_Update",
                        "Microsoft.Intune_Organization_Read",
                        "Microsoft.Intune_ManagedDevices_Read",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Create",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Delete",
                        "Microsoft.Intune_Organization_Create",
                        "Microsoft.Intune_Customization_Create",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Update",
                        "Microsoft.Intune_ManagedApps_Assign",
                        "Microsoft.Intune_MobileApps_Create",
                        "Microsoft.Intune_MobileApps_Delete",
                        "Microsoft.Intune_Customization_Update",
                        "Microsoft.Intune_DeviceConfigurations_Assign",
                        "Microsoft.Intune_DeviceCompliancePolices_Read",
                        "Microsoft.Intune_DeviceConfigurations_Create",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Read",
                        "Microsoft.Intune_PartnerDeviceManagement_Read",
                        "Microsoft.Intune_EnrollmentProgramToken_Read",
                        "Microsoft.Intune_Roles_Read",
                        "Microsoft.Intune_DeviceConfigurations_Delete",
                        "Microsoft.Intune_RemoteAssistance_ViewReports",
                        "Microsoft.Intune_Customization_Delete",
                        "Microsoft.Intune_ManagedApps_Delete",
                        "Microsoft.Intune_RemoteAssistanceApp_TakeFullControl",
                        "Microsoft.Intune_DeviceCompliancePolices_ViewReports",
                        "Microsoft.Intune_Organization_Update",
                        "Microsoft.Intune_ChromebookSync_Read",
                        "Microsoft.Intune_Organization_Delete",
                        "Microsoft.Intune_SecurityBaselines_Delete",
                        "Microsoft.Intune_DerivedCredentials_Read",
                        "Microsoft.Intune_EndpointAnalytics_Create",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Create",
                        "Microsoft.Intune_RemoteAssistanceApp_ViewScreen",
                        "Microsoft.Intune_ManagedDevices_SetPrimaryUser",
                        "Microsoft.Intune_EnrollmentProgramToken_Update",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Update",
                        "Microsoft.Intune_SecurityBaselines_Update",
                        "Microsoft.Intune_SecurityBaselines_Assign",
                        "Microsoft.Intune_SecurityTasks_Read",
                        "Microsoft.Intune_MobileApps_Assign",
                        "Microsoft.Intune_ManagedApps_Update",
                        "Microsoft.Intune_ManagedApps_Create",
                        "Microsoft.Intune_SecurityTasks_Update",
                        "Microsoft.Intune_TelecomExpenses_Read",
                        "Microsoft.Intune_AssignmentFilter_Update",
                        "Microsoft.Intune_AssignmentFilter_Delete",
                        "Microsoft.Intune_EndpointAnalytics_Update",
                        "Microsoft.Intune_MobileThreatDefense_Read",
                        "Microsoft.Intune_EndpointProtection_Read",
                        "Microsoft.Intune_RemoteAssistance_Update",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Read",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Create",
                        "Microsoft.Intune_EndpointAnalytics_Read",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Delete",
                        "Microsoft.Intune_TermsAndConditions_Create",
                        "Microsoft.Intune_CloudAttach_Collections",
                        "Microsoft.Intune_CloudAttach_ResourceExplorer",
                        "Microsoft.Intune_CloudAttach_Timeline",
                        "Microsoft.Intune_ManagedDeviceCleanupSettings_Update",
                        "Microsoft.Intune_MultiAdminApproval_DeleteAccessPolicy",
                        "Microsoft.Intune_MultiAdminApproval_UpdateAccessPolicy",
                        "Microsoft.Intune_ServiceNow_ViewIncidents",
                        "Microsoft.Intune_TermsAndConditions_Delete",
                        "Microsoft.Intune_DeviceConfigurations_Read",
                        "Microsoft.Intune_AndroidFota_Delete",
                        "Microsoft.Intune_AndroidFota_Assign",
                        "Microsoft.Intune_QuietTimePolicies_Create",
                        "Microsoft.Intune_CloudAttach_Scripts",
                        "Microsoft.Intune_CloudAttach_SoftwareUpdates",
                        "Microsoft.Intune_OrganizationalMessages_Read",
                        "Microsoft.Intune_OrganizationalMessages_Create",
                        "Microsoft.Intune_MultiAdminApproval_ReadAccessPolicy",
                        "Microsoft.Intune_EpmPolicy_ViewReports",
                        "Microsoft.Intune_OrganizationalMessages_UpdateControl",
                        "Microsoft.Intune_TermsAndConditions_Read",
                        "Microsoft.Intune_SecurityBaselines_Create",
                        "Microsoft.Intune_EndpointAnalytics_Delete",
                        "Microsoft.Intune_SecurityBaselines_Read",
                        "Microsoft.Intune_AssignmentFilter_Read",
                        "Microsoft.Intune_ManagedDevices_Delete",
                        "Microsoft.Intune_EnrollmentProgramToken_Create",
                        "Microsoft.Intune_DeviceCompliancePolices_Assign",
                        "Microsoft.Intune_ManagedDevices_Update",
                        "Microsoft.Intune_CertificateConnector_Read",
                        "Microsoft.Intune_TermsAndConditions_Update",
                        "Microsoft.Intune_DerivedCredentials_Modify",
                        "Microsoft.Intune_MicrosoftDefenderATP_Read",
                        "Microsoft.Intune_MobileApps_Relate",
                        "Microsoft.Intune_AndroidFota_Create",
                        "Microsoft.Intune_QuietTimePolicies_Update",
                        "Microsoft.Intune_CloudAttach_ScriptActions",
                        "Microsoft.Intune_EpmPolicy_Read",
                        "Microsoft.Intune_Audit_Read",
                        "Microsoft.Intune_DeviceConfigurations_ViewReports",
                        "Microsoft.Intune_DeviceEnrollmentManagers_Update",
                        "Microsoft.Intune_Customization_Assign",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Read",
                        "Microsoft.Intune_MicrosoftTunnelGateway_Read",
                        "Microsoft.Intune_DeviceConfigurations_Update",
                        "Microsoft.Intune_AssignmentFilter_Create",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Delete",
                        "Microsoft.Intune_MicrosoftStoreForBusiness_Read",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Assign",
                        "Microsoft.Intune_ManagedGooglePlay_Read",
                        "Microsoft.Intune_DeviceCompliancePolices_Delete",
                        "Microsoft.Intune_DeviceCompliancePolices_Update",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Update",
                        "Microsoft.Intune_AndroidFota_Read",
                        "Microsoft.Intune_QuietTimePolicies_Delete",
                        "Microsoft.Intune_QuietTimePolicies_Assign",
                        "Microsoft.Intune_QuietTimePolicies_Read",
                        "Microsoft.Intune_CloudAttach_CMPivot",
                        "Microsoft.Intune_EpmPolicy_Create",
                        "Microsoft.Intune_WindowsEnterpriseCertificate_Read",
                        "Microsoft.Intune_RemoteAssistanceApp_Elevation",
                        "Microsoft.Intune_MobileApps_ViewReports",
                        "Microsoft.Intune_RemoteAssistance_Read",
                        "Microsoft.Intune_EnrollmentProgramToken_Delete",
                        "Microsoft.Intune_DeviceEnrollmentManagers_Read",
                        "Microsoft.Intune_DeviceCompliancePolices_Create",
                        "Microsoft.Intune_ManagedDevices_ViewReports",
                        "Microsoft.Intune_TermsAndConditions_Assign",
                        "Microsoft.Intune_AndroidFota_Update",
                        "Microsoft.Intune_QuietTimePolicies_ViewReports",
                        "Microsoft.Intune_CloudAttach_ClientDetails",
                        "Microsoft.Intune_CloudAttach_ApplicationActions",
                        "Microsoft.Intune_CloudAttach_Applications",
                        "Microsoft.Intune_OrganizationalMessages_Update",
                        "Microsoft.Intune_OrganizationalMessages_Delete",
                        "Microsoft.Intune_CloudAttach_EnrollNow",
                        "Microsoft.Intune_MultiAdminApproval_CreateAccessPolicy",
                        "Microsoft.Intune_EpmPolicy_Delete",
                        "Microsoft.Intune_EpmPolicy_Update",
                        "Microsoft.Intune_EpmPolicy_Assign",
                        "Microsoft.Intune_OrganizationalMessages_Assign"
                    ],
                    "resourceActions": [
                        {
                            "allowedResourceActions": [
                                "Microsoft.Intune_AndroidSync_Read",
                                "Microsoft.Intune_MobileApps_Read",
                                "Microsoft.Intune_ManagedApps_Read",
                                "Microsoft.Intune_PolicySets_Read",
                                "Microsoft.Intune_ManagedApps_Wipe",
                                "Microsoft.Intune_Reports_Read",
                                "Microsoft.Intune_Customization_Read",
                                "Microsoft.Intune_MobileApps_Update",
                                "Microsoft.Intune_Organization_Read",
                                "Microsoft.Intune_ManagedDevices_Read",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Create",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Delete",
                                "Microsoft.Intune_Organization_Create",
                                "Microsoft.Intune_Customization_Create",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Update",
                                "Microsoft.Intune_ManagedApps_Assign",
                                "Microsoft.Intune_MobileApps_Create",
                                "Microsoft.Intune_MobileApps_Delete",
                                "Microsoft.Intune_Customization_Update",
                                "Microsoft.Intune_DeviceConfigurations_Assign",
                                "Microsoft.Intune_DeviceCompliancePolices_Read",
                                "Microsoft.Intune_DeviceConfigurations_Create",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Read",
                                "Microsoft.Intune_PartnerDeviceManagement_Read",
                                "Microsoft.Intune_EnrollmentProgramToken_Read",
                                "Microsoft.Intune_Roles_Read",
                                "Microsoft.Intune_DeviceConfigurations_Delete",
                                "Microsoft.Intune_RemoteAssistance_ViewReports",
                                "Microsoft.Intune_Customization_Delete",
                                "Microsoft.Intune_ManagedApps_Delete",
                                "Microsoft.Intune_RemoteAssistanceApp_TakeFullControl",
                                "Microsoft.Intune_DeviceCompliancePolices_ViewReports",
                                "Microsoft.Intune_Organization_Update",
                                "Microsoft.Intune_ChromebookSync_Read",
                                "Microsoft.Intune_Organization_Delete",
                                "Microsoft.Intune_SecurityBaselines_Delete",
                                "Microsoft.Intune_DerivedCredentials_Read",
                                "Microsoft.Intune_EndpointAnalytics_Create",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Create",
                                "Microsoft.Intune_RemoteAssistanceApp_ViewScreen",
                                "Microsoft.Intune_ManagedDevices_SetPrimaryUser",
                                "Microsoft.Intune_EnrollmentProgramToken_Update",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Update",
                                "Microsoft.Intune_SecurityBaselines_Update",
                                "Microsoft.Intune_SecurityBaselines_Assign",
                                "Microsoft.Intune_SecurityTasks_Read",
                                "Microsoft.Intune_MobileApps_Assign",
                                "Microsoft.Intune_ManagedApps_Update",
                                "Microsoft.Intune_ManagedApps_Create",
                                "Microsoft.Intune_SecurityTasks_Update",
                                "Microsoft.Intune_TelecomExpenses_Read",
                                "Microsoft.Intune_AssignmentFilter_Update",
                                "Microsoft.Intune_AssignmentFilter_Delete",
                                "Microsoft.Intune_EndpointAnalytics_Update",
                                "Microsoft.Intune_MobileThreatDefense_Read",
                                "Microsoft.Intune_EndpointProtection_Read",
                                "Microsoft.Intune_RemoteAssistance_Update",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Read",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Create",
                                "Microsoft.Intune_EndpointAnalytics_Read",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Delete",
                                "Microsoft.Intune_TermsAndConditions_Create",
                                "Microsoft.Intune_CloudAttach_Collections",
                                "Microsoft.Intune_CloudAttach_ResourceExplorer",
                                "Microsoft.Intune_CloudAttach_Timeline",
                                "Microsoft.Intune_ManagedDeviceCleanupSettings_Update",
                                "Microsoft.Intune_MultiAdminApproval_DeleteAccessPolicy",
                                "Microsoft.Intune_MultiAdminApproval_UpdateAccessPolicy",
                                "Microsoft.Intune_ServiceNow_ViewIncidents",
                                "Microsoft.Intune_TermsAndConditions_Delete",
                                "Microsoft.Intune_DeviceConfigurations_Read",
                                "Microsoft.Intune_AndroidFota_Delete",
                                "Microsoft.Intune_AndroidFota_Assign",
                                "Microsoft.Intune_QuietTimePolicies_Create",
                                "Microsoft.Intune_CloudAttach_Scripts",
                                "Microsoft.Intune_CloudAttach_SoftwareUpdates",
                                "Microsoft.Intune_OrganizationalMessages_Read",
                                "Microsoft.Intune_OrganizationalMessages_Create",
                                "Microsoft.Intune_MultiAdminApproval_ReadAccessPolicy",
                                "Microsoft.Intune_EpmPolicy_ViewReports",
                                "Microsoft.Intune_OrganizationalMessages_UpdateControl",
                                "Microsoft.Intune_TermsAndConditions_Read",
                                "Microsoft.Intune_SecurityBaselines_Create",
                                "Microsoft.Intune_EndpointAnalytics_Delete",
                                "Microsoft.Intune_SecurityBaselines_Read",
                                "Microsoft.Intune_AssignmentFilter_Read",
                                "Microsoft.Intune_ManagedDevices_Delete",
                                "Microsoft.Intune_EnrollmentProgramToken_Create",
                                "Microsoft.Intune_DeviceCompliancePolices_Assign",
                                "Microsoft.Intune_ManagedDevices_Update",
                                "Microsoft.Intune_CertificateConnector_Read",
                                "Microsoft.Intune_TermsAndConditions_Update",
                                "Microsoft.Intune_DerivedCredentials_Modify",
                                "Microsoft.Intune_MicrosoftDefenderATP_Read",
                                "Microsoft.Intune_MobileApps_Relate",
                                "Microsoft.Intune_AndroidFota_Create",
                                "Microsoft.Intune_QuietTimePolicies_Update",
                                "Microsoft.Intune_CloudAttach_ScriptActions",
                                "Microsoft.Intune_EpmPolicy_Read",
                                "Microsoft.Intune_Audit_Read",
                                "Microsoft.Intune_DeviceConfigurations_ViewReports",
                                "Microsoft.Intune_DeviceEnrollmentManagers_Update",
                                "Microsoft.Intune_Customization_Assign",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Read",
                                "Microsoft.Intune_MicrosoftTunnelGateway_Read",
                                "Microsoft.Intune_DeviceConfigurations_Update",
                                "Microsoft.Intune_AssignmentFilter_Create",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Delete",
                                "Microsoft.Intune_MicrosoftStoreForBusiness_Read",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Assign",
                                "Microsoft.Intune_ManagedGooglePlay_Read",
                                "Microsoft.Intune_DeviceCompliancePolices_Delete",
                                "Microsoft.Intune_DeviceCompliancePolices_Update",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Update",
                                "Microsoft.Intune_AndroidFota_Read",
                                "Microsoft.Intune_QuietTimePolicies_Delete",
                                "Microsoft.Intune_QuietTimePolicies_Assign",
                                "Microsoft.Intune_QuietTimePolicies_Read",
                                "Microsoft.Intune_CloudAttach_CMPivot",
                                "Microsoft.Intune_EpmPolicy_Create",
                                "Microsoft.Intune_WindowsEnterpriseCertificate_Read",
                                "Microsoft.Intune_RemoteAssistanceApp_Elevation",
                                "Microsoft.Intune_MobileApps_ViewReports",
                                "Microsoft.Intune_RemoteAssistance_Read",
                                "Microsoft.Intune_EnrollmentProgramToken_Delete",
                                "Microsoft.Intune_DeviceEnrollmentManagers_Read",
                                "Microsoft.Intune_DeviceCompliancePolices_Create",
                                "Microsoft.Intune_ManagedDevices_ViewReports",
                                "Microsoft.Intune_TermsAndConditions_Assign",
                                "Microsoft.Intune_AndroidFota_Update",
                                "Microsoft.Intune_QuietTimePolicies_ViewReports",
                                "Microsoft.Intune_CloudAttach_ClientDetails",
                                "Microsoft.Intune_CloudAttach_ApplicationActions",
                                "Microsoft.Intune_CloudAttach_Applications",
                                "Microsoft.Intune_OrganizationalMessages_Update",
                                "Microsoft.Intune_OrganizationalMessages_Delete",
                                "Microsoft.Intune_CloudAttach_EnrollNow",
                                "Microsoft.Intune_MultiAdminApproval_CreateAccessPolicy",
                                "Microsoft.Intune_EpmPolicy_Delete",
                                "Microsoft.Intune_EpmPolicy_Update",
                                "Microsoft.Intune_EpmPolicy_Assign",
                                "Microsoft.Intune_OrganizationalMessages_Assign"
                            ],
                            "notAllowedResourceActions": []
                        }
                    ]
                }
            ],
            "rolePermissions": [
                {
                    "actions": [
                        "Microsoft.Intune_AndroidSync_Read",
                        "Microsoft.Intune_MobileApps_Read",
                        "Microsoft.Intune_ManagedApps_Read",
                        "Microsoft.Intune_PolicySets_Read",
                        "Microsoft.Intune_ManagedApps_Wipe",
                        "Microsoft.Intune_Reports_Read",
                        "Microsoft.Intune_Customization_Read",
                        "Microsoft.Intune_MobileApps_Update",
                        "Microsoft.Intune_Organization_Read",
                        "Microsoft.Intune_ManagedDevices_Read",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Create",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Delete",
                        "Microsoft.Intune_Organization_Create",
                        "Microsoft.Intune_Customization_Create",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Update",
                        "Microsoft.Intune_ManagedApps_Assign",
                        "Microsoft.Intune_MobileApps_Create",
                        "Microsoft.Intune_MobileApps_Delete",
                        "Microsoft.Intune_Customization_Update",
                        "Microsoft.Intune_DeviceConfigurations_Assign",
                        "Microsoft.Intune_DeviceCompliancePolices_Read",
                        "Microsoft.Intune_DeviceConfigurations_Create",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Read",
                        "Microsoft.Intune_PartnerDeviceManagement_Read",
                        "Microsoft.Intune_EnrollmentProgramToken_Read",
                        "Microsoft.Intune_Roles_Read",
                        "Microsoft.Intune_DeviceConfigurations_Delete",
                        "Microsoft.Intune_RemoteAssistance_ViewReports",
                        "Microsoft.Intune_Customization_Delete",
                        "Microsoft.Intune_ManagedApps_Delete",
                        "Microsoft.Intune_RemoteAssistanceApp_TakeFullControl",
                        "Microsoft.Intune_DeviceCompliancePolices_ViewReports",
                        "Microsoft.Intune_Organization_Update",
                        "Microsoft.Intune_ChromebookSync_Read",
                        "Microsoft.Intune_Organization_Delete",
                        "Microsoft.Intune_SecurityBaselines_Delete",
                        "Microsoft.Intune_DerivedCredentials_Read",
                        "Microsoft.Intune_EndpointAnalytics_Create",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Create",
                        "Microsoft.Intune_RemoteAssistanceApp_ViewScreen",
                        "Microsoft.Intune_ManagedDevices_SetPrimaryUser",
                        "Microsoft.Intune_EnrollmentProgramToken_Update",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Update",
                        "Microsoft.Intune_SecurityBaselines_Update",
                        "Microsoft.Intune_SecurityBaselines_Assign",
                        "Microsoft.Intune_SecurityTasks_Read",
                        "Microsoft.Intune_MobileApps_Assign",
                        "Microsoft.Intune_ManagedApps_Update",
                        "Microsoft.Intune_ManagedApps_Create",
                        "Microsoft.Intune_SecurityTasks_Update",
                        "Microsoft.Intune_TelecomExpenses_Read",
                        "Microsoft.Intune_AssignmentFilter_Update",
                        "Microsoft.Intune_AssignmentFilter_Delete",
                        "Microsoft.Intune_EndpointAnalytics_Update",
                        "Microsoft.Intune_MobileThreatDefense_Read",
                        "Microsoft.Intune_EndpointProtection_Read",
                        "Microsoft.Intune_RemoteAssistance_Update",
                        "Microsoft.Intune_AppleDeviceSerialNumbers_Read",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Create",
                        "Microsoft.Intune_EndpointAnalytics_Read",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Delete",
                        "Microsoft.Intune_TermsAndConditions_Create",
                        "Microsoft.Intune_CloudAttach_Collections",
                        "Microsoft.Intune_CloudAttach_ResourceExplorer",
                        "Microsoft.Intune_CloudAttach_Timeline",
                        "Microsoft.Intune_ManagedDeviceCleanupSettings_Update",
                        "Microsoft.Intune_MultiAdminApproval_DeleteAccessPolicy",
                        "Microsoft.Intune_MultiAdminApproval_UpdateAccessPolicy",
                        "Microsoft.Intune_ServiceNow_ViewIncidents",
                        "Microsoft.Intune_TermsAndConditions_Delete",
                        "Microsoft.Intune_DeviceConfigurations_Read",
                        "Microsoft.Intune_AndroidFota_Delete",
                        "Microsoft.Intune_AndroidFota_Assign",
                        "Microsoft.Intune_QuietTimePolicies_Create",
                        "Microsoft.Intune_CloudAttach_Scripts",
                        "Microsoft.Intune_CloudAttach_SoftwareUpdates",
                        "Microsoft.Intune_OrganizationalMessages_Read",
                        "Microsoft.Intune_OrganizationalMessages_Create",
                        "Microsoft.Intune_MultiAdminApproval_ReadAccessPolicy",
                        "Microsoft.Intune_EpmPolicy_ViewReports",
                        "Microsoft.Intune_OrganizationalMessages_UpdateControl",
                        "Microsoft.Intune_TermsAndConditions_Read",
                        "Microsoft.Intune_SecurityBaselines_Create",
                        "Microsoft.Intune_EndpointAnalytics_Delete",
                        "Microsoft.Intune_SecurityBaselines_Read",
                        "Microsoft.Intune_AssignmentFilter_Read",
                        "Microsoft.Intune_ManagedDevices_Delete",
                        "Microsoft.Intune_EnrollmentProgramToken_Create",
                        "Microsoft.Intune_DeviceCompliancePolices_Assign",
                        "Microsoft.Intune_ManagedDevices_Update",
                        "Microsoft.Intune_CertificateConnector_Read",
                        "Microsoft.Intune_TermsAndConditions_Update",
                        "Microsoft.Intune_DerivedCredentials_Modify",
                        "Microsoft.Intune_MicrosoftDefenderATP_Read",
                        "Microsoft.Intune_MobileApps_Relate",
                        "Microsoft.Intune_AndroidFota_Create",
                        "Microsoft.Intune_QuietTimePolicies_Update",
                        "Microsoft.Intune_CloudAttach_ScriptActions",
                        "Microsoft.Intune_EpmPolicy_Read",
                        "Microsoft.Intune_Audit_Read",
                        "Microsoft.Intune_DeviceConfigurations_ViewReports",
                        "Microsoft.Intune_DeviceEnrollmentManagers_Update",
                        "Microsoft.Intune_Customization_Assign",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Read",
                        "Microsoft.Intune_MicrosoftTunnelGateway_Read",
                        "Microsoft.Intune_DeviceConfigurations_Update",
                        "Microsoft.Intune_AssignmentFilter_Create",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Delete",
                        "Microsoft.Intune_MicrosoftStoreForBusiness_Read",
                        "Microsoft.Intune_AppleEnrollmentProfiles_Assign",
                        "Microsoft.Intune_ManagedGooglePlay_Read",
                        "Microsoft.Intune_DeviceCompliancePolices_Delete",
                        "Microsoft.Intune_DeviceCompliancePolices_Update",
                        "Microsoft.Intune_CorporateDeviceIdentifiers_Update",
                        "Microsoft.Intune_AndroidFota_Read",
                        "Microsoft.Intune_QuietTimePolicies_Delete",
                        "Microsoft.Intune_QuietTimePolicies_Assign",
                        "Microsoft.Intune_QuietTimePolicies_Read",
                        "Microsoft.Intune_CloudAttach_CMPivot",
                        "Microsoft.Intune_EpmPolicy_Create",
                        "Microsoft.Intune_WindowsEnterpriseCertificate_Read",
                        "Microsoft.Intune_RemoteAssistanceApp_Elevation",
                        "Microsoft.Intune_MobileApps_ViewReports",
                        "Microsoft.Intune_RemoteAssistance_Read",
                        "Microsoft.Intune_EnrollmentProgramToken_Delete",
                        "Microsoft.Intune_DeviceEnrollmentManagers_Read",
                        "Microsoft.Intune_DeviceCompliancePolices_Create",
                        "Microsoft.Intune_ManagedDevices_ViewReports",
                        "Microsoft.Intune_TermsAndConditions_Assign",
                        "Microsoft.Intune_AndroidFota_Update",
                        "Microsoft.Intune_QuietTimePolicies_ViewReports",
                        "Microsoft.Intune_CloudAttach_ClientDetails",
                        "Microsoft.Intune_CloudAttach_ApplicationActions",
                        "Microsoft.Intune_CloudAttach_Applications",
                        "Microsoft.Intune_OrganizationalMessages_Update",
                        "Microsoft.Intune_OrganizationalMessages_Delete",
                        "Microsoft.Intune_CloudAttach_EnrollNow",
                        "Microsoft.Intune_MultiAdminApproval_CreateAccessPolicy",
                        "Microsoft.Intune_EpmPolicy_Delete",
                        "Microsoft.Intune_EpmPolicy_Update",
                        "Microsoft.Intune_EpmPolicy_Assign",
                        "Microsoft.Intune_OrganizationalMessages_Assign"
                    ],
                    "resourceActions": [
                        {
                            "allowedResourceActions": [
                                "Microsoft.Intune_AndroidSync_Read",
                                "Microsoft.Intune_MobileApps_Read",
                                "Microsoft.Intune_ManagedApps_Read",
                                "Microsoft.Intune_PolicySets_Read",
                                "Microsoft.Intune_ManagedApps_Wipe",
                                "Microsoft.Intune_Reports_Read",
                                "Microsoft.Intune_Customization_Read",
                                "Microsoft.Intune_MobileApps_Update",
                                "Microsoft.Intune_Organization_Read",
                                "Microsoft.Intune_ManagedDevices_Read",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Create",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Delete",
                                "Microsoft.Intune_Organization_Create",
                                "Microsoft.Intune_Customization_Create",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Update",
                                "Microsoft.Intune_ManagedApps_Assign",
                                "Microsoft.Intune_MobileApps_Create",
                                "Microsoft.Intune_MobileApps_Delete",
                                "Microsoft.Intune_Customization_Update",
                                "Microsoft.Intune_DeviceConfigurations_Assign",
                                "Microsoft.Intune_DeviceCompliancePolices_Read",
                                "Microsoft.Intune_DeviceConfigurations_Create",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Read",
                                "Microsoft.Intune_PartnerDeviceManagement_Read",
                                "Microsoft.Intune_EnrollmentProgramToken_Read",
                                "Microsoft.Intune_Roles_Read",
                                "Microsoft.Intune_DeviceConfigurations_Delete",
                                "Microsoft.Intune_RemoteAssistance_ViewReports",
                                "Microsoft.Intune_Customization_Delete",
                                "Microsoft.Intune_ManagedApps_Delete",
                                "Microsoft.Intune_RemoteAssistanceApp_TakeFullControl",
                                "Microsoft.Intune_DeviceCompliancePolices_ViewReports",
                                "Microsoft.Intune_Organization_Update",
                                "Microsoft.Intune_ChromebookSync_Read",
                                "Microsoft.Intune_Organization_Delete",
                                "Microsoft.Intune_SecurityBaselines_Delete",
                                "Microsoft.Intune_DerivedCredentials_Read",
                                "Microsoft.Intune_EndpointAnalytics_Create",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Create",
                                "Microsoft.Intune_RemoteAssistanceApp_ViewScreen",
                                "Microsoft.Intune_ManagedDevices_SetPrimaryUser",
                                "Microsoft.Intune_EnrollmentProgramToken_Update",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Update",
                                "Microsoft.Intune_SecurityBaselines_Update",
                                "Microsoft.Intune_SecurityBaselines_Assign",
                                "Microsoft.Intune_SecurityTasks_Read",
                                "Microsoft.Intune_MobileApps_Assign",
                                "Microsoft.Intune_ManagedApps_Update",
                                "Microsoft.Intune_ManagedApps_Create",
                                "Microsoft.Intune_SecurityTasks_Update",
                                "Microsoft.Intune_TelecomExpenses_Read",
                                "Microsoft.Intune_AssignmentFilter_Update",
                                "Microsoft.Intune_AssignmentFilter_Delete",
                                "Microsoft.Intune_EndpointAnalytics_Update",
                                "Microsoft.Intune_MobileThreatDefense_Read",
                                "Microsoft.Intune_EndpointProtection_Read",
                                "Microsoft.Intune_RemoteAssistance_Update",
                                "Microsoft.Intune_AppleDeviceSerialNumbers_Read",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Create",
                                "Microsoft.Intune_EndpointAnalytics_Read",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Delete",
                                "Microsoft.Intune_TermsAndConditions_Create",
                                "Microsoft.Intune_CloudAttach_Collections",
                                "Microsoft.Intune_CloudAttach_ResourceExplorer",
                                "Microsoft.Intune_CloudAttach_Timeline",
                                "Microsoft.Intune_ManagedDeviceCleanupSettings_Update",
                                "Microsoft.Intune_MultiAdminApproval_DeleteAccessPolicy",
                                "Microsoft.Intune_MultiAdminApproval_UpdateAccessPolicy",
                                "Microsoft.Intune_ServiceNow_ViewIncidents",
                                "Microsoft.Intune_TermsAndConditions_Delete",
                                "Microsoft.Intune_DeviceConfigurations_Read",
                                "Microsoft.Intune_AndroidFota_Delete",
                                "Microsoft.Intune_AndroidFota_Assign",
                                "Microsoft.Intune_QuietTimePolicies_Create",
                                "Microsoft.Intune_CloudAttach_Scripts",
                                "Microsoft.Intune_CloudAttach_SoftwareUpdates",
                                "Microsoft.Intune_OrganizationalMessages_Read",
                                "Microsoft.Intune_OrganizationalMessages_Create",
                                "Microsoft.Intune_MultiAdminApproval_ReadAccessPolicy",
                                "Microsoft.Intune_EpmPolicy_ViewReports",
                                "Microsoft.Intune_OrganizationalMessages_UpdateControl",
                                "Microsoft.Intune_TermsAndConditions_Read",
                                "Microsoft.Intune_SecurityBaselines_Create",
                                "Microsoft.Intune_EndpointAnalytics_Delete",
                                "Microsoft.Intune_SecurityBaselines_Read",
                                "Microsoft.Intune_AssignmentFilter_Read",
                                "Microsoft.Intune_ManagedDevices_Delete",
                                "Microsoft.Intune_EnrollmentProgramToken_Create",
                                "Microsoft.Intune_DeviceCompliancePolices_Assign",
                                "Microsoft.Intune_ManagedDevices_Update",
                                "Microsoft.Intune_CertificateConnector_Read",
                                "Microsoft.Intune_TermsAndConditions_Update",
                                "Microsoft.Intune_DerivedCredentials_Modify",
                                "Microsoft.Intune_MicrosoftDefenderATP_Read",
                                "Microsoft.Intune_MobileApps_Relate",
                                "Microsoft.Intune_AndroidFota_Create",
                                "Microsoft.Intune_QuietTimePolicies_Update",
                                "Microsoft.Intune_CloudAttach_ScriptActions",
                                "Microsoft.Intune_EpmPolicy_Read",
                                "Microsoft.Intune_Audit_Read",
                                "Microsoft.Intune_DeviceConfigurations_ViewReports",
                                "Microsoft.Intune_DeviceEnrollmentManagers_Update",
                                "Microsoft.Intune_Customization_Assign",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Read",
                                "Microsoft.Intune_MicrosoftTunnelGateway_Read",
                                "Microsoft.Intune_DeviceConfigurations_Update",
                                "Microsoft.Intune_AssignmentFilter_Create",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Delete",
                                "Microsoft.Intune_MicrosoftStoreForBusiness_Read",
                                "Microsoft.Intune_AppleEnrollmentProfiles_Assign",
                                "Microsoft.Intune_ManagedGooglePlay_Read",
                                "Microsoft.Intune_DeviceCompliancePolices_Delete",
                                "Microsoft.Intune_DeviceCompliancePolices_Update",
                                "Microsoft.Intune_CorporateDeviceIdentifiers_Update",
                                "Microsoft.Intune_AndroidFota_Read",
                                "Microsoft.Intune_QuietTimePolicies_Delete",
                                "Microsoft.Intune_QuietTimePolicies_Assign",
                                "Microsoft.Intune_QuietTimePolicies_Read",
                                "Microsoft.Intune_CloudAttach_CMPivot",
                                "Microsoft.Intune_EpmPolicy_Create",
                                "Microsoft.Intune_WindowsEnterpriseCertificate_Read",
                                "Microsoft.Intune_RemoteAssistanceApp_Elevation",
                                "Microsoft.Intune_MobileApps_ViewReports",
                                "Microsoft.Intune_RemoteAssistance_Read",
                                "Microsoft.Intune_EnrollmentProgramToken_Delete",
                                "Microsoft.Intune_DeviceEnrollmentManagers_Read",
                                "Microsoft.Intune_DeviceCompliancePolices_Create",
                                "Microsoft.Intune_ManagedDevices_ViewReports",
                                "Microsoft.Intune_TermsAndConditions_Assign",
                                "Microsoft.Intune_AndroidFota_Update",
                                "Microsoft.Intune_QuietTimePolicies_ViewReports",
                                "Microsoft.Intune_CloudAttach_ClientDetails",
                                "Microsoft.Intune_CloudAttach_ApplicationActions",
                                "Microsoft.Intune_CloudAttach_Applications",
                                "Microsoft.Intune_OrganizationalMessages_Update",
                                "Microsoft.Intune_OrganizationalMessages_Delete",
                                "Microsoft.Intune_CloudAttach_EnrollNow",
                                "Microsoft.Intune_MultiAdminApproval_CreateAccessPolicy",
                                "Microsoft.Intune_EpmPolicy_Delete",
                                "Microsoft.Intune_EpmPolicy_Update",
                                "Microsoft.Intune_EpmPolicy_Assign",
                                "Microsoft.Intune_OrganizationalMessages_Assign"
                            ],
                            "notAllowedResourceActions": []
                        }
                    ]
                }
            ]
        }
    ]
    }
'@

# Invoke the Graph request to create the custom Intune role
Invoke-MgGraphRequest -Uri $uri -body $json -Method POST -ContentType "application/json"